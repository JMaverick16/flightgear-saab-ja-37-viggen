<?xml version="1.0"?>

<flight_control name="JA37 FC">

    <channel execrate="4" name="Canopy">

        <!-- canopy get stuck if it fail -->
        <switch name="names/canopy/tmp-engage">
            <default value="fcs/canopy/engage"/>
            <test logic="OR" value="fcs/canopy/pos-norm">
            fcs/canopy/serviceable == 0
            fcs/canopy/has-power == 0
          </test>
            <output>fcs/canopy/engageTmp</output>
        </switch>

        <kinematic name="names/canopy/pos-norm">
            <input>fcs/canopy/engageTmp</input>
            <traverse>
                <setting>
                    <position>0.0</position>
                    <time>0.0</time>
                </setting>
                <setting>
                    <position>1.0</position>
                    <time>5.0</time>
                </setting>
            </traverse>
            <output>fcs/canopy/pos-norm</output>
        </kinematic>

        <pure_gain name="names/canopy/mp">
            <input>fcs/canopy/pos-norm</input>
            <gain>1</gain>
            <output>/canopy/position-norm</output>
            <!-- used for auto MP transmit and animation -->
        </pure_gain>
    </channel>

    <!--
                   Elevator -25 to +20  (page 131, figure 108b) 
                   Elevator -25 to +20  (page 133, figure 110a)
                   Elevator -25 to +20  (page  79, figure  62a)
                   Pretty sure I saw something about max +10 for elevator, but no longer know where.

                   Aileron  -15 to +15  (page 133, figure 110b)

                   Rudder   -25 to +25  (page 115, figure  92 )

                   Flaps           +30  (page  87)
                   Flaps     -4 to +30  (page  78,  figure 60 )
                   Flaps     -7 to +30  (page  76) -7 can be selected by pilot in AJ-37 not JA-37, -4 default
                   Flaps     -7 to +30  (page  46) 

-->


    <channel execrate="1" name="Elevators">
        <!-- Elevator contribution can move elevons 20 degrees down, and 25 degrees up -->

        <fcs_function name="fcs/elevator/stick-geared">
            <function>
                <product>
                    <table>
                        <independentVar lookup="row">fcs/elevator-cmd-norm</independentVar>
                        <tableData>
                            -1.00  -1.00
                            -0.86  -0.74
                            -0.75  -0.56
                            -0.62  -0.40
                            -0.50  -0.28
                            -0.38  -0.19
                            -0.23  -0.11
                            -0.10  -0.045
                             0.00   0.00
                             0.10   0.045
                             0.23   0.11
                             0.38   0.19
                             0.50   0.28
                             0.62   0.40
                             0.75   0.56
                             0.86   0.74
                             1.00   1.00
                        </tableData>
                    </table>
                </product>
            </function>
        </fcs_function>

        <switch name="fcs/elevator/alpha-limit-speed">
            <default value="350.9719"/>
            <test logic="AND" value="377.96976">
                /ja37/systems/variant == 1
            </test>
        </switch>

        <switch name="fcs/elevator/alpha-limit">
            <default value="180"/>
            <test logic="AND" value="23">
                <!-- JA and calibrated airspeed less than 650 km/h -->
                /ja37/systems/variant == 0
                velocities/vc-kts lt fcs/elevator/alpha-limit-speed
            </test>
            <test logic="AND" value="18">
                <!-- AJ and calibrated airspeed less than 700 km/h -->
                /ja37/systems/variant == 0
                velocities/vc-kts lt fcs/elevator/alpha-limit-speed
            </test>
        </switch>

        <fcs_function name="fcs/elevator/cmd-abs-inv">
            <function>
                <difference>
                    <value>1</value>
                    <product>
                        <table>
                            <independentVar lookup="row">/instrumentation/airspeed-indicator/indicated-speed-kt</independentVar>
                            <tableData>
                                300    0.00
                                400    0.35
                            </tableData>
                        </table>
                        <abs>
                            <property>fcs/elevator/stick-geared</property>
                        </abs>
                    </product>
                </difference>
            </function>
        </fcs_function>

        <switch name="names/pitch-damper/active">
            <default value="0.0"/>
            <test logic="AND" value="fcs/elevator/cmd-abs-inv">
                gear/unit[0]/WOW ne 1
                aero/spin-norm == 0
                fcs/pitch-damper/enable ne 0.0
                fcs/pitch-damper/serviceable == 1
            </test>
            <output>fcs/pitch-damper/active</output>
        </switch>

        <scheduled_gain name="names/pitch-damper/pitch-rate-unfiltered">
            <input>velocities/q-aero-rad_sec</input>
            <table>
                <independentVar lookup="row">velocities/ve-kts</independentVar>
                <tableData>
                    30.0   0.00
                    60.0   1.00
                </tableData>
            </table>
            <gain>fcs/pitch-damper/pitch-rate-gain</gain>            <!-- default 2 -->
            <output>fcs/pitch-damper/pitch-rate-unfiltered</output>
        </scheduled_gain>

        <fcs_function name="accelerations/Nz-centered">
            <function>
                <sum>
                    <property>accelerations/Nz</property>
                    <value>-1</value>
                </sum>
            </function>
        </fcs_function>

        <scheduled_gain name="names/pitch-damper/nz-rate-unfiltered">
            <input>accelerations/Nz-centered</input>
            <table>
                <independentVar lookup="row">velocities/ve-kts</independentVar>
                <tableData>
                    30.0   0.00
                    60.0   1.00
                </tableData>
            </table>
            <gain>fcs/pitch-damper/nz-rate-gain</gain>            <!-- default ? -->
            <output>fcs/pitch-damper/nz-rate-unfiltered</output>
        </scheduled_gain>

        <fcs_function name="fcs/pitch-damper/rate-unfiltered">
            <function>
                <sum>
                    <property>fcs/pitch-damper/nz-rate-unfiltered</property>
                    <property>fcs/pitch-damper/pitch-rate-unfiltered</property>
                </sum>
            </function>
        </fcs_function>

        <washout_filter name="names/pitch-damper/rate-washout">
            <input>fcs/pitch-damper/pitch-rate-unfiltered</input>
            <c1>fcs/pitch-damper/washout-factor</c1>            <!-- default 1.33 -->
            <clipto>
                <min>-0.3</min>
                <max> 0.3</max>
            </clipto>
            <output>fcs/pitch-damper/rate-washout</output>
        </washout_filter>

        <scheduled_gain name="fcs/pitch-damper/rate-qbar">
            <input>fcs/pitch-damper/rate-washout</input>
            <table>
                <independentVar lookup="row">aero/qbar-psf</independentVar>
                <tableData>
                     0     1.00
                     800   1.00
                     850   0.70
                     1000  0.40
                     1300  0.25
                     1500  0.15
                     2500  0.10
                </tableData>
            </table>
        </scheduled_gain>

        <pure_gain name="names/pitch-damper/rate">
            <input>fcs/pitch-damper/rate-qbar</input>
            <gain>fcs/pitch-damper/active</gain>
            <gain>fcs/pitch-damper/qbar-limit</gain>
            <output>fcs/pitch-damper/rate</output>
        </pure_gain>

        <fcs_function name="fcs/elevator/stick-css-neg">
            <function>
                <difference>
                    <property> fcs/elevator/stick-geared </property>
                    <value> -0.15 </value>
                </difference>
            </function>
        </fcs_function>

        <fcs_function name="fcs/elevator/stick-css-pos">
            <function>
                <difference>
                    <property> fcs/elevator/stick-geared </property>
                    <value> 0.15 </value>
                </difference>
            </function>
        </fcs_function>

        <switch name="fcs/elevator/stick-css-deadzone">
            <default value="0"/>
            <test logic="AND" value="fcs/elevator/stick-css-pos">
                fcs/elevator/stick-geared gt  0.15
            </test>
            <test logic="AND" value="fcs/elevator/stick-css-neg">
                fcs/elevator/stick-geared lt  -0.15
            </test>
            <output>/controls/flight/elevator-cmd-ap</output>
        </switch>

        <switch name="fcs/elevator/stick-css">
            <default value="0"/>
            <test logic="OR" value="fcs/elevator/stick-css-deadzone">
                /ja37/avionics/temp-halt-ap-pitch == 0
            </test>
        </switch>

        <switch name="fcs/elevator/stick-css-ap">
            <default value="0"/>
            <test logic="AND" value="/controls/flight/elevator-ap">
                /ja37/avionics/temp-halt-ap-pitch == 1
                /ja37/avionics/auto-altitude-on == 1
            </test>
            <output>/controls/flight/elevator-ap</output>
        </switch>

        <pure_gain name="fcs/elevator/stick-geared-switched">
            <input>fcs/elevator/stick-geared</input>
            <gain>/ja37/avionics/temp-halt-ap-pitch</gain>
        </pure_gain>

        <summer name="names/elevator/cmd-sum">
            <input>fcs/elevator/stick-geared-switched</input>
            <input>fcs/elevator/stick-css</input>
            <input>/controls/flight/elevator-ap</input>
            <input>fcs/pitch-trim-cmd-norm</input>
            <input>fcs/pitch-damper/rate</input>
            <clipto>
                <min>-1.0</min>
                <max>1.0</max>
            </clipto>
            <output>fcs/elevator/cmd-sum</output>
        </summer>

        <fcs_function name="systems/flight/pitch-gearing-aj37">
            <function>
                <product>
                    <table>
                        <independentVar lookup="row">velocities/mach</independentVar>
                        <independentVar lookup="column">atmosphere/density-altitude</independentVar>
                        <tableData>
                                   0.0  6562  13123 19685 26247 29527 36089
                            0.32  -22    -22   -22    -22   -22  -22    -22  
                            0.70  -8.7   -10   -13    -16   -18.5 -20   -22   
                            0.95  -8.7   -8.7  -10    -15   -20   -20   -22      
                            1.05  -11.8  -11.8 -13.5  -16.5 -21  -22    -22      
                            1.20  -11.8  -11.8 -15    -18.5 -22  -22    -22      
                            1.40  -11.8  -14   -16    -20   -22  -22    -22
                            1.50  -11.8  -15   -17    -21   -22  -22    -22      
                        </tableData>
                    </table>
                    <v>-1</v>
               </product>
            </function>
        </fcs_function>

        <aerosurface_scale name="systems/flight/pitch-gearing-aj37-norm">
            <input>systems/flight/pitch-gearing-aj37</input>
            <zero_centered> true </zero_centered>
            <domain>
                <min> -16.0 </min>
                <max>  22.0 </max>
            </domain>
            <range>
                <min>-1</min>                
                <max>1</max>
            </range>
        </aerosurface_scale>

        <fcs_function name="systems/flight/pitch-gearing-ja37">
            <function>
                <product>
                    <table>
                        <independentVar lookup="row">velocities/mach</independentVar>
                        <independentVar lookup="column">atmosphere/density-altitude</independentVar>
                        <tableData>
                                        0.0      6562  13123 19685 26247 29527
                            0.40        -22.0   -22.0  -22.0 -22.0 -22.0 -22.0
                            0.70        -11.8   -12.5  -15.5 -20.0 -22.0 -22.0
                            0.95        -15.3   -15.3  -12.5 -16.5 -20.0 -22.0
                            1.05        -15.3   -15.3  -15.5 -20.0 -22.0 -22.0
                            1.20        -15.3   -15.3  -18.0 -22.0 -22.0 -22.0
                            1.40        -15.3   -16.0  -20.5 -22.0 -22.0 -22.0
                            1.50        -15.3   -20.0  -22.0 -22.0 -22.0 -22.0
                        </tableData>
                    </table>
                    <v>-1</v>
               </product>
            </function>
        </fcs_function>

        <aerosurface_scale name="systems/flight/pitch-gearing-ja37-norm">
            <input>systems/flight/pitch-gearing-ja37</input>
            <zero_centered> true </zero_centered>
            <domain>
                <min> -16.0 </min>
                <max>  22.0 </max>
            </domain>
            <range>
                <min>-1</min>                
                <max>1</max>
            </range>
        </aerosurface_scale>

        <switch name="systems/flight/pitch-gearing-norm">
            <default value="systems/flight/pitch-gearing-ja37-norm"/>
            <test logic="OR" value="systems/flight/pitch-gearing-aj37-norm">
               /ja37/systems/variant == 1
            </test>
        </switch>

        <fcs_function name="systems/flight/pitch-gearing-fun">
            <function>
                <product>
                    <table>
                        <independentVar lookup="row">velocities/mach</independentVar>
                        <independentVar lookup="column">atmosphere/density-altitude</independentVar>
                        <tableData>
                                        0.0      20000     45000
                            0.00        1.00      0.85      0.65            
                            0.10        0.85      0.85      0.65
                            0.50        0.75      0.75      0.65
                            0.65        0.50      0.75      0.65
                            0.80        0.35      0.75      0.65
                            1.00        0.30      0.60      0.75
                            1.50        0.20      0.35      0.75
                            2.00        0.10      0.20      0.70
                        </tableData>
                    </table>
                    <!--<property>/test</property>-->
               </product>
            </function>
        </fcs_function>

        <switch name="systems/flight/pitch-gearing">
            <default value="systems/flight/pitch-gearing-norm"/>
            <test logic="OR" value="systems/flight/pitch-gearing-fun">
                /ja37/avionics/fun == 1
            </test>
        </switch>

        <!-- At high speeds elevator up deflection is reduced,
           At high altitude elevator up deflection is increased -->
        <pure_gain name="names/elevator/adjust-neg">
            <input>fcs/elevator/cmd-sum</input>
            <gain>systems/flight/pitch-gearing</gain>
            <output>fcs/elevator/cmd-adjust-negative</output>
        </pure_gain>

        <!-- At high speeds elevator down deflection is reduced,
           At high altitude elevator down deflection is increased -->
        <scheduled_gain name="names/elevator/adjust-pos">
            <input>fcs/elevator/cmd-adjust-negative</input>
            <table>
                <independentVar lookup="row">gear/gear-pos-norm</independentVar>
                <independentVar lookup="column">/instrumentation/airspeed-indicator/indicated-speed-kt</independentVar>
                <tableData>
                            0    100     150    400
                     0     0.60  0.60    0.60   0.60
                     1     1.0   1.0     0.50   1.00
                </tableData>
            </table>
            <output>fcs/elevator/cmd-adjust-positive</output>
        </scheduled_gain>

        <!-- select which of the above tables is active -->
        <switch name="fcs/elevator/cmd-final">
            <default value="fcs/elevator/cmd-adjust-positive"/>
            <test logic="OR" value="fcs/elevator/cmd-sum">
                fcs/elevator/gearing-enable == 0
            </test>
            <test logic="OR" value="fcs/elevator/cmd-adjust-negative">
                fcs/elevator/cmd-sum lt 0
            </test>
        </switch>

        <kinematic name="names/elevator/pos-norm">
            <input>fcs/elevator/tmp-norm</input>
            <traverse>
                <setting>
                    <position> -1.0 </position>
                    <time>      0.0 </time>
                </setting>
                <setting>
                    <position>  1.0 </position>
                    <time>      1.5 </time><!-- high number will prevent too much instant G when fast pulling back -->
                </setting>
            </traverse>
            <clipto>
                <min>
                    <property>-systems/hydraulics/flight-surface-actuation</property>
                </min>
                <max>
                    <property>systems/hydraulics/flight-surface-actuation</property>
                </max>
            </clipto>
            <output>fcs/elevator/pos-norm</output>
        </kinematic>

        <scheduled_gain name="fcs/elevator/alpha-scheduler-ja37">
            <input>fcs/elevator/cmd-final</input>
            <table>
                <independentVar>aero/alpha-deg</independentVar>
                <tableData>
                -23     0.00
                -21     0.60
                 0.0    1.00
                 21     0.60
                 23     0.00
                </tableData>
            </table>
        </scheduled_gain>

        <scheduled_gain name="fcs/elevator/alpha-scheduler-aj37">
            <input>fcs/elevator/cmd-final</input>
            <table>
                <independentVar>aero/alpha-deg</independentVar>
                <tableData>
                -18     0.00
                -16     0.60
                 0.0    1.00
                 16     0.60
                 18     0.00
                </tableData>
            </table>
        </scheduled_gain>

        <switch name="fcs/elevator/alpha-scheduler">
            <default value="fcs/elevator/alpha-scheduler-ja37"/>
            <test logic="OR" value="fcs/elevator/alpha-scheduler-aj37">
               /ja37/systems/variant == 1
            </test>
            <clipto>
                <min>-1</min>
                <max>1</max>
            </clipto>
        </switch>
        
        <switch name="names/elevator/tmp-norm">
            <default value="fcs/elevator/alpha-scheduler"/>
            <test logic="OR" value="0">
                structural/wings/serviceable == 0
            </test>
            <test logic="OR" value="fcs/elevator/pos-norm">
                systems/hydraulics/flight-surface-actuation == 0
                fcs/elevator/serviceable == 0
            </test>            
            <test logic="AND" value="fcs/elevator/cmd-final">
                <!-- not sure if this should be here or not.
                     Remove this test to make alpha limiter works in all regimes -->
                velocities/vc-kts gt fcs/elevator/alpha-limit-speed
            </test>
            <output>fcs/elevator/tmp-norm</output>
        </switch>

        <!--<aerosurface_scale name="names/elevator/trim-deg">
            <input>fcs/pitch-trim-cmd-norm</input>
            <zero_centered> true </zero_centered>
            <domain>
                <min> -1.0 </min>
                <max>  1.0 </max>
            </domain>
            <range>
                <min>-22</min>
                <max>16</max>
            </range>
            <output>fcs/elevator/trim-deg</output>
        </aerosurface_scale>-->

        <aerosurface_scale name="names/elevator/pos-rad">
            <input>fcs/elevator/pos-norm</input>
            <zero_centered> true </zero_centered>
            <domain>
                <min> -1.0 </min>
                <max>  1.0 </max>
            </domain>
            <range>
                <min>-0.38397</min>                <!--  -22 deg -->
                <max>0.27925</max>                <!--    16 deg -->
            </range>
            <output>fcs/elevator-pos-rad</output>
        </aerosurface_scale>

    </channel>










    <channel execrate="1" name="Ailerons">

        <fcs_function name="fcs/aileron/stick-geared">
            <function>
                <table>
                    <independentVar lookup="row">fcs/aileron-cmd-norm</independentVar>
                    <tableData>
                        -1.00  -1.00
                        -0.86  -0.74
                        -0.75  -0.56
                        -0.62  -0.40
                        -0.50  -0.28
                        -0.38  -0.19
                        -0.23  -0.11
                        -0.10  -0.045
                         0.00   0.00
                         0.10   0.045
                         0.23   0.11
                         0.38   0.19
                         0.50   0.28
                         0.62   0.40
                         0.75   0.56
                         0.86   0.74
                         1.00   1.00
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <switch name="names/roll-limiter/active">
            <default value="0.0"/>
            <test logic="AND" value="1">
                aero/alpha-deg ge -10
                aero/alpha-deg le  10
                gear/unit[0]/WOW ne 1
                gear/unit[1]/WOW ne 1
                gear/unit[2]/WOW ne 1
                aero/spin-norm == 0
                fcs/roll-limiter/enable ne 0.0
                fcs/roll-limiter/serviceable == 1
            </test>
            <output>fcs/roll-limiter/active</output>
        </switch>

        <scheduled_gain name="names/roll-limiter/rate-unfiltered">
            <input>velocities/p-aero-rad_sec</input>
            <table>
                <independentVar lookup="row">velocities/ve-kts</independentVar>
                <tableData>
                      30.0   0.00
                      60.0  -1.00
                </tableData>
            </table>
            <gain>fcs/roll-limiter/roll-rate-gain</gain>            <!-- 0.10 default -->
            <output>fcs/roll-limiter/rate-unfiltered</output>
        </scheduled_gain>

        <!--<washout_filter name="names/roll-limiter/rate-washout">
        <input>fcs/roll-limiter/rate-unfiltered</input>
        <c1>fcs/roll-limiter/washout-factor</c1>
        <clipto>
          <min>-0.50</min>
          <max>0.50</max>
        </clipto>
        <output>fcs/roll-limiter/rate-washout</output>
      </washout_filter>-->

        <!-- at roll rate faster than 225deg/s limiter kicks in -->
        <switch name="names/roll-limiter/rate-switched">
            <default value="fcs/roll-limiter/rate-unfiltered"/>
            <test logic="AND" value="0">
                fcs/roll-limiter/rate-unfiltered le 0.393
                fcs/roll-limiter/rate-unfiltered ge -0.393
            </test>
            <output>fcs/roll-limiter/rate-switched</output>
        </switch>

        <pure_gain name="names/roll-limiter/rate">
            <input>fcs/roll-limiter/rate-switched</input>
            <gain>fcs/roll-limiter/active</gain>
            <output>fcs/roll-limiter/rate</output>
        </pure_gain>

        <fcs_function name="fcs/aileron/cmd-inv">
            <function>
                <difference>
                    <value>1</value>
                    <product>
                        <abs>
                            <property>fcs/aileron/stick-geared</property>
                        </abs>
                    </product>
                </difference>
            </function>
        </fcs_function>

        <switch name="names/roll-damper/active">
            <default value="0.0"/>
            <test logic="AND" value="fcs/aileron/cmd-inv">
                    aero/alpha-deg ge -30
                    aero/alpha-deg le  30
                    gear/unit[0]/WOW ne 1
                    gear/unit[1]/WOW ne 1
                    gear/unit[2]/WOW ne 1
                    aero/spin-norm == 0
                    fcs/roll-damper/enable ne 0.0
                    fcs/roll-damper/serviceable == 1
            </test>
            <output>fcs/roll-damper/active</output>
        </switch>

        <scheduled_gain name="names/roll-damper/rate-unfiltered">
            <input>velocities/p-aero-rad_sec</input>
            <table>
                <independentVar lookup="row">velocities/ve-kts</independentVar>
                <tableData>
                      30.0   0.00
                      60.0  -1.00
                </tableData>
            </table>
            <gain>fcs/roll-damper/roll-rate-gain</gain>            <!-- 0.10 default -->
            <output>fcs/roll-damper/rate-unfiltered</output>
        </scheduled_gain>

        <!--<washout_filter name="names/roll-damper/rate-washout">
            <input>fcs/roll-damper/rate-unfiltered</input>
            <c1>fcs/roll-damper/washout-factor</c1>
            <clipto>
                <min>-0.50</min>
                <max>0.50</max>
            </clipto>
            <output>fcs/roll-damper/rate-washout</output>
        </washout_filter>-->

        <pure_gain name="names/roll-damper/rate">
            <input>fcs/roll-damper/rate-unfiltered</input>
            <gain>fcs/roll-damper/active</gain>
            <output>fcs/roll-damper/rate</output>
        </pure_gain>

        <fcs_function name="fcs/aileron/stick-css-neg">
            <function>
                <difference>
                    <property> fcs/aileron/stick-geared </property>
                    <value> -0.15 </value>
                </difference>
            </function>
        </fcs_function>

        <fcs_function name="fcs/aileron/stick-css-pos">
            <function>
                <difference>
                    <property> fcs/aileron/stick-geared </property>
                    <value> 0.15 </value>
                </difference>
            </function>
        </fcs_function>

        <switch name="fcs/aileron/stick-css-deadzone">
            <default value="0"/>
            <test logic="AND" value="fcs/aileron/stick-css-pos">
                fcs/aileron/stick-geared gt  0.15
            </test>
            <test logic="AND" value="fcs/aileron/stick-css-neg">
                fcs/aileron/stick-geared lt  -0.15
            </test>
            <output>/controls/flight/aileron-cmd-ap</output>
        </switch>

        <switch name="fcs/aileron/stick-css">
            <default value="0"/>
            <test logic="OR" value="fcs/aileron/stick-css-deadzone">
                /ja37/avionics/temp-halt-ap-roll2 == 0
            </test>
        </switch>

        <switch name="fcs/aileron/stick-css-ap">
            <default value="0"/>
            <test logic="OR" value="/controls/flight/aileron-ap">
                /ja37/avionics/temp-halt-ap-roll2 == 1
                /ja37/avionics/auto-attitude-on == 1
            </test>
            <output>/controls/flight/aileron-ap</output>
        </switch>

        <pure_gain name="fcs/aileron/stick-geared-switched">
            <input>fcs/aileron/stick-geared</input>
            <gain>/ja37/avionics/temp-halt-ap-roll2</gain>
        </pure_gain>

        <summer name="names/aileron/cmd-sum">
            <input>fcs/aileron/stick-geared-switched</input>
            <input>fcs/aileron/stick-css</input>
            <input>/controls/flight/aileron-ap</input>
            <input>fcs/roll-trim-cmd-norm</input>
            <input>fcs/roll-limiter/rate</input>
            <input>fcs/roll-damper/rate</input>
            <clipto>
                <min>-1.0</min>
                <max>1.0</max>
            </clipto>
            <output>fcs/aileron/cmd-sum</output>
        </summer>

        <!-- At high speeds aileron deflection is reduced -->
        <scheduled_gain name="names/aileron/cmd-sum-geared">
            <input>fcs/aileron/cmd-sum</input>
            <table>
                <independentVar lookup="row">velocities/mach</independentVar>
                <independentVar lookup="column">atmosphere/density-altitude</independentVar>
                <tableData>
                                  0.0         60000.0
                      0.0         1.00           1.0
                      0.1         0.45           1.0   
                      0.5         0.35           0.75  <!-- roll rate 125 - 150 degrees/sec with roll damper on -->
                      0.75        0.65           0.60
                      1.0         0.30           0.45  <!-- roll rate 200 - 225 degrees/sec with roll damper on -->
                      2.2         0.06           0.225 <!-- roll rate 200 - 225 degrees/sec with roll damper on -->
                </tableData>
            </table>
            <gain>fcs/aileron/limit-factor</gain>
            <clipto>
                <min>-1.0</min>
                <max>1.0</max>
            </clipto>
            <output>fcs/aileron/cmd-sum-geared</output>
        </scheduled_gain>

        <kinematic name="names/aileron/pos-norm">
            <input>fcs/aileron/tmp-norm</input>
            <traverse>
                <setting>
                    <position> -1.0 </position>
                    <time>      0.0 </time>
                </setting>
                <setting>
                    <position>  1.0 </position>
                    <time>      0.25 </time>
                </setting>
            </traverse>
            <clipto>
                <min>
                    <property>-systems/hydraulics/flight-surface-actuation</property>
                </min>
                <max>
                    <property>systems/hydraulics/flight-surface-actuation</property>
                </max>
            </clipto>
            <output>fcs/aileron/pos-norm</output>
        </kinematic>

        <switch name="names/aileron/tmp-norm">
            <default value="fcs/aileron/cmd-sum"/>
            <test logic="OR" value="0">
                structural/wings/serviceable == 0
            </test>
            <test logic="OR" value="fcs/aileron/pos-norm">
                systems/hydraulics/flight-surface-actuation == 0
                fcs/aileron/serviceable == 0
            </test>
            <test logic="OR" value="fcs/aileron/cmd-sum-geared">
                fcs/aileron/gearing-enable == 1
            </test>
            <output>fcs/aileron/tmp-norm</output>
        </switch>

        <aerosurface_scale name="names/aileron/pos-rad-left">
            <input>fcs/aileron/pos-norm</input>
            <domain>
                <min> -1.0 </min>
                <max>  1.0 </max>
            </domain>
            <range>
                <min>-0.2618</min>                <!-- -15 deg -->
                <max>0.2618</max>                <!--   15 deg -->
            </range>
            <output>fcs/left-aileron-pos-rad</output>
        </aerosurface_scale>

        <aerosurface_scale name="names/aileron/pos-rad-right">
            <input>-fcs/aileron/pos-norm</input>
            <domain>
                <min> -1.0 </min>
                <max>  1.0 </max>
            </domain>
            <range>
                <min>-0.2618</min>                <!-- -15 deg -->
                <max>0.2618</max>                <!--   15 deg -->
            </range>
            <output>fcs/right-aileron-pos-rad</output>
        </aerosurface_scale>

        <pure_gain name="names/aileron/pos-deg-left">
            <input>fcs/left-aileron-pos-rad</input>
            <gain>57.296</gain>
            <output>fcs/left-aileron-pos-deg</output>
        </pure_gain>

    </channel>    

    <channel execrate="1" name="Elevons">

        <summer name="names/elevon/Left-Elevon-Pos-Rad">
            <input>fcs/left-aileron-pos-rad</input>
            <input>fcs/elevator-pos-rad</input>
            <output>fcs/left-elevon-pos-rad</output>
        </summer>

        <summer name="names/elevon/Right-Elevon-Pos-Rad">
            <input>fcs/right-aileron-pos-rad</input>
            <input>fcs/elevator-pos-rad</input>
            <output>fcs/right-elevon-pos-rad</output>
        </summer>

        <pure_gain name="names/elevon/Left-Elevon-Pos-Deg">
            <input>fcs/left-elevon-pos-rad</input>
            <gain>57.296</gain>
            <output>fcs/left-aileron-pos-norm</output>
            <!-- is really deg, but use this for MP transmit -->
        </pure_gain>

        <pure_gain name="names/elevon/Right-Elevon-Pos-Deg">
            <input>fcs/right-elevon-pos-rad</input>
            <gain>57.296</gain>
            <output>fcs/right-aileron-pos-norm</output>
            <!-- is really deg, but use this for MP transmit -->
        </pure_gain>
    </channel>





    <channel execrate="1" name="Yaw">
        <!-- Rudder can move 25 degrees to each side -->

        <fcs_function name="fcs/rudder/stick-geared">
            <function>
                <table>
                    <independentVar lookup="row">fcs/rudder-cmd-norm</independentVar>
                    <tableData>
                        -1.00  -1.00
                        -0.86  -0.74
                        -0.75  -0.56
                        -0.62  -0.40
                        -0.50  -0.28
                        -0.38  -0.19
                        -0.23  -0.11
                        -0.10  -0.045
                         0.00   0.00
                         0.10   0.045
                         0.23   0.11
                         0.38   0.19
                         0.50   0.28
                         0.62   0.40
                         0.75   0.56
                         0.86   0.74
                         1.00   1.00
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <switch name="names/yaw-damper/active">
            <default value="0.0"/>
            <test logic="AND" value="1"
                >
            aero/spin-norm == 0
            fcs/yaw-damper/enable ne 0.0
            fcs/yaw-damper/serviceable == 1
        </test>
            <output>fcs/yaw-damper/active</output>
        </switch>

        <scheduled_gain name="names/yaw-damper/roll-rate-unfiltered">
            <input>velocities/p-aero-rad_sec</input>
            <table>
                <independentVar lookup="row">velocities/ve-kts</independentVar>
                <tableData>
            30.0   0.00
            60.0   1.00
         </tableData>
            </table>
            <clipto>
                <min>-0.5</min>
                <max> 0.5</max>
            </clipto>
            <gain>fcs/yaw-damper/roll-rate-gain</gain>            <!-- default 0.125 -->
            <output>fcs/yaw-damper/roll-rate-unfiltered</output>
        </scheduled_gain>

        <scheduled_gain name="names/yaw-damper/lateral-acc-unfiltered">
            <input>accelerations/vdot-ft_sec2</input>
            <table>
                <independentVar lookup="row">velocities/ve-kts</independentVar>
                <tableData>
            30.0   0.00
            60.0   1.00
         </tableData>
            </table>
            <gain>fcs/yaw-damper/lateral-acc-gain</gain>            <!-- default -0.05 -->
            <output>fcs/yaw-damper/lateral-acc-unfiltered</output>
        </scheduled_gain>

        <scheduled_gain name="names/yaw-damper/yaw-rate-unfiltered">
            <input>velocities/r-aero-rad_sec</input>
            <table>
                <independentVar lookup="row">velocities/ve-kts</independentVar>
                <tableData>
            30.0   0.00
            60.0   1.00
         </tableData>
            </table>
            <gain>fcs/yaw-damper/yaw-rate-gain</gain>            <!-- default 4 -->
            <output>fcs/yaw-damper/yaw-rate-unfiltered</output>
        </scheduled_gain>

        <switch name="names/yaw-damper/damper-input">
            <default value="fcs/yaw-damper/yaw-rate-unfiltered"/>
            <test logic="AND" value="fcs/yaw-damper/lateral-acc-unfiltered">
            fcs/yaw-damper/yaw-rate-unfiltered ge 0
            fcs/yaw-damper/lateral-acc-unfiltered ge 0
            fcs/yaw-damper/lateral-acc-unfiltered ge fcs/yaw-damper/yaw-rate-unfiltered
        </test>
            <test logic="AND" value="fcs/yaw-damper/lateral-acc-unfiltered">
            fcs/yaw-damper/yaw-rate-unfiltered le 0
            fcs/yaw-damper/lateral-acc-unfiltered le 0
            fcs/yaw-damper/lateral-acc-unfiltered le fcs/yaw-damper/yaw-rate-unfiltered
        </test>
            <test logic="AND" value="0">
            fcs/yaw-damper/yaw-rate-unfiltered ge 0
            fcs/yaw-damper/lateral-acc-unfiltered le 0
        </test>
            <test logic="AND" value="0">
            fcs/yaw-damper/yaw-rate-unfiltered le 0
            fcs/yaw-damper/lateral-acc-unfiltered ge 0
        </test>
            <output>fcs/yaw-damper/damper-input</output>
        </switch>

        <washout_filter name="names/yaw-damper/rate-washout">
            <input>fcs/yaw-damper/damper-input</input>
            <c1>fcs/yaw-damper/washout-factor</c1>            <!-- default 1 -->
            <clipto>
                <min>-0.5</min>
                <max> 0.5</max>
            </clipto>
            <output>fcs/yaw-damper/rate-washout</output>
        </washout_filter>

        <switch name="names/yaw-damper/rate-combined">
            <default value="fcs/yaw-damper/rate-washout"/>
            <test logic="AND" value="fcs/yaw-damper/roll-rate-unfiltered">
            fcs/yaw-damper/roll-rate-unfiltered ge 0.25
        </test>
            <test logic="AND" value="fcs/yaw-damper/roll-rate-unfiltered">
            fcs/yaw-damper/roll-rate-unfiltered le -0.25
        </test>
            <output>fcs/yaw-damper/rate-combined</output>
        </switch>

        <pure_gain name="names/yaw-damper/rate">
            <input>fcs/yaw-damper/rate-combined</input>
            <gain>fcs/yaw-damper/active</gain>
            <output>fcs/yaw-damper/rate</output>
        </pure_gain>

        <summer name="names/rudder/cmd-sum">
            <input>fcs/rudder/stick-geared</input>
            <input>fcs/yaw-trim-cmd-norm</input>
            <input>fcs/yaw-damper/rate</input>
            <clipto>
                <min> -1.0 </min>
                <max>  1.0 </max>
            </clipto>
            <output>fcs/rudder/cmd-sum</output>
        </summer>

        <!-- At high speeds rudder deflection is reduced -->
        <scheduled_gain name="names/rudder/cmd-sum-geared">
            <input>fcs/rudder/cmd-sum</input>
            <table>
                <independentVar lookup="row">velocities/mach</independentVar>
                <independentVar lookup="column">atmosphere/density-altitude</independentVar>
                <tableData>
                          0.0         70000.0
              0.0         1.00           1.00
              0.1         0.60           1.00
              0.5         0.22           0.40
              1.0         0.15           0.25
              2.2         0.07           0.10              
          </tableData>
            </table>
            <output>fcs/rudder/cmd-sum-geared</output>
        </scheduled_gain>

        <kinematic name="names/rudder/pos-norm">
            <input>fcs/rudder/tmp-norm</input>
            <traverse>
                <setting>
                    <position> -1.0 </position>
                    <time>      0.0 </time>
                </setting>
                <setting>
                    <position>  1.0 </position>
                    <time>      0.5 </time>
                </setting>
            </traverse>
            <clipto>
                <min>
                    <property>-systems/hydraulics/flight-surface-actuation</property>
                </min>
                <max>
                    <property>systems/hydraulics/flight-surface-actuation</property>
                </max>
            </clipto>
            <output>fcs/rudder-pos-norm</output>
        </kinematic>

        <switch name="names/rudder/tmp-norm">
            <default value="fcs/rudder/cmd-sum"/>
            <test logic="OR" value="fcs/rudder-pos-norm">
          systems/hydraulics/flight-surface-actuation == 0
          fcs/rudder/serviceable == 0
        </test>
            <test logic="OR" value="fcs/rudder/cmd-sum-geared">
          fcs/rudder/gearing-enable == 1
        </test>
            <output>fcs/rudder/tmp-norm</output>
        </switch>

        <aerosurface_scale name="names/rudder/pos-rad">
            <input>fcs/rudder-pos-norm</input>
            <domain>
                <min> -1.0 </min>
                <max>  1.0 </max>
            </domain>
            <range>
                <min> -0.4363 </min>
                <max>  0.4363 </max>                <!-- 25 deg -->
            </range>
            <output>fcs/rudder-pos-rad</output>
        </aerosurface_scale>

        <aerosurface_scale name="names/rudder/pos-deg">
            <input>fcs/rudder-pos-norm</input>
            <domain>
                <min> -1.0 </min>
                <max>  1.0 </max>
            </domain>
            <range>
                <min> -25 </min>
                <max>  25 </max>
            </range>
            <output>fcs/rudder-pos-deg</output>
        </aerosurface_scale>
    </channel>





    <channel execrate="1" name="Landing Gear">

        <switch name="names/gear-target-norm">
            <default value="gear/gear-cmd-norm"/>
            <test logic="OR" value="1">
                  gear/unit[0]/WOW == 1
                  gear/unit[1]/WOW == 1
                  gear/unit[2]/WOW == 1
            </test>
            <test logic="AND" value="0">
                  gear/gear-pos-norm == 0
                  velocities/vc-kts gt 334.77
            </test>
            <test logic="AND" value="0">
                  gear/gear-pos-norm == 0
                  velocities/mach gt 0.65
            </test>
            <!-- at loss of hydr-1 the gears can go down, but not up: -->
            <test logic="AND" value="gear/gear-pos-norm">
                  gear/gear-cmd-norm == 0
                  systems/hydraulics/system1/pressure == 0
            </test>
            <test logic="AND" value="gear/gear-cmd-norm">
                  gear/gear-cmd-norm == 1
                  systems/hydraulics/system1/pressure == 0
            </test>
            <clipto>
                <min>  0 </min>
                <max>  1 </max>
            </clipto>
            <output>gear/gear-target-norm</output>
        </switch>

        <switch name="names/gear-filtered-norm">
            <default value="gear/gear-target-norm"/>
            <test logic="OR" value="gear/gear-pos-norm">
                  systems/hydraulics/flight-surface-actuation == 0
                  gear/serviceable == 0
            </test>
            <clipto>
                <min>  0 </min>
                <max>  1 </max>
            </clipto>
            <output>gear/gear-filtered-norm</output>
        </switch>

        <kinematic name="names/gear-pos-norm">
            <input>gear/gear-filtered-norm</input>
            <traverse>
                <setting>
                    <position>0.0</position>
                    <time>0.0</time>
                </setting>
                <setting>
                    <position>1.0</position>
                    <time>7</time>
                </setting>
            </traverse>
            <output>gear/gear-pos-norm</output>
        </kinematic>

        <kinematic name="names/nose-wheel-steering/kinematic-norm">
            <input>gear/unit[0]/nose-wheel-steering/tmp-norm</input>
            <traverse>
                <setting>
                    <position>-1.0</position>
                    <time>0.0</time>
                </setting>
                <setting>
                    <position>1.0</position>
                    <time>0.5</time>
                </setting>
            </traverse>
            <output>gear/unit[0]/nose-wheel-steering/kinematic-norm</output>
        </kinematic>

        <switch name="names/nose-wheel-steering/tmp-norm">
            <default value="fcs/steer-cmd-norm"/>
            <test logic="OR" value="gear/unit[0]/nose-wheel-steering/kinematic-norm">
                systems/hydraulics/flight-surface-actuation == 0
                gear/unit[0]/nose-wheel-steering/serviceable == 0
            </test>
            <test logic="OR" value="0">
                gear/unit[0]/nose-wheel-steering/enable == 0
            </test>
            <output>gear/unit[0]/nose-wheel-steering/tmp-norm</output>
        </switch>

        <!-- Page 180 of JA-37C manual: maximum 30 degs deflection -->
        <scheduled_gain name="names/nose-wheel-steering/steer-pos-deg">
            <input>gear/unit[0]/nose-wheel-steering/kinematic-norm</input>
            <table>
                <independentVar>velocities/vg-fps</independentVar>
                <tableData><!-- note that this is positive also when moving in reverse -->
                       10.0       30.00
                       20.0       25.00
                       50.0        5.00
                      100.0        1.50
                      150.0        0.75
                      200.0        0.50 <!-- by this speed the front wheel hardly touches the runway -->
                </tableData>
            </table>
            <output>fcs/steer-pos-deg</output>
        </scheduled_gain>
    </channel>



    <channel execrate="1" name="Flaps">
        <!-- Can move 30 degrees down, and 4 degrees up -->

        <kinematic name="names/flaps/pos-norm">
            <input>fcs/flaps/tmp-norm</input>
            <traverse>
                <setting>
                    <position>  0.0 </position>
                    <time>      0.0 </time>
                </setting>
                <setting>
                    <position>  1.0 </position>
                    <time>     10.0 </time> <!-- from videos it looks to take 10-15 secs to retract flaps. -->
                </setting>
            </traverse>
            <output>fcs/flaps/pos-normalized</output>
        </kinematic>

        <switch name="names/flaps/tmp-norm">
            <default value="gear/gear-target-norm"/>
            <!-- flaps controlled by gear-->
            <test logic="OR" value="fcs/flaps/pos-normalized">
                  systems/hydraulics/flight-surface-actuation == 0
                  fcs/flaps/serviceable == 0
            </test>
            <test logic="OR" value="0.11765"><!-- default flaps position -->
                fcs/flaps/pos-cmd == 0
            </test>
            <output>fcs/flaps/tmp-norm</output>
        </switch>

        <aerosurface_scale name="names/flaps/pos-deg">
            <input>fcs/flaps/pos-normalized</input>
            <zero_centered> false </zero_centered>
            <domain>
                <min>  0.0 </min>
                <max>  1.0 </max>
            </domain>
            <range>
                <min> -4.0 </min>
                <max> 30.0 </max>
            </range>
            <output>fcs/flap-pos-deg</output>
        </aerosurface_scale>

        <pure_gain name="names/flaps/pos-deg-MP">
            <input>fcs/flap-pos-deg</input>
            <gain>1</gain>
            <output>fcs/flap-pos-norm</output>
            <!-- is really deg, used for auto MP transmit and animation -->
        </pure_gain>

    </channel>





    <channel execrate="1" name="Throttle"><!-- execrate must be 1, else wont overwrite fcs/throttle-pos-norm properly -->

        <aerosurface_scale name="names/throttle/pos-norm-scale">
            <input>/controls/engines/engine/throttle</input>
            <zero_centered> false </zero_centered>
            <domain>
                <min>  0.00 </min>
                <max>  0.90 </max>
            </domain>
            <range>
                <min>  0.0 </min>
                <max>  1.0 </max>
            </range>
            <clipto>
                <min>  0 </min>
                <max>  1 </max>
            </clipto>
            <output>fcs/throttle-pos-norm-scale</output>
        </aerosurface_scale>

        <!-- factor for augmentation power -->
        <aerosurface_scale name="names/throttle/zone-factor">
            <input>/controls/engines/engine/throttle</input>
            <zero_centered> false </zero_centered>
            <domain>
                <min>  0.94 </min>
                <max>  1.00 </max>
            </domain>
            <range>
                <min>  0.60 </min>
                <max>  1.00 </max>
            </range>
            <output>propulsion/engine/zone-factor</output>
        </aerosurface_scale>

        <!-- augmentation zone -->
        <switch name="names/throttle/zone">
            <default value="0"/>
            <test logic="AND" value="0">
              fcs/throttle-cmd-norm lt 0.94
          </test>
            <test logic="AND" value="1">
              fcs/throttle-cmd-norm lt 0.96
          </test>
            <test logic="AND" value="2">
              fcs/throttle-cmd-norm lt 0.98
          </test>
            <test logic="AND" value="3">
              fcs/throttle-cmd-norm gt 0.98
          </test>
            <output>propulsion/engine/zone</output>
        </switch>

        <!-- used for animating nozzle indicator -->
        <aerosurface_scale name="names/throttle/zone-scaled">
            <input>fcs/throttle-cmd-norm</input>
            <zero_centered> false </zero_centered>
            <domain>
                <min>  0.94 </min>
                <max>  1.00 </max>
            </domain>
            <range>
                <min>  0.00 </min>
                <max>  1.00 </max>
            </range>
            <output>propulsion/engine/zone-scaled</output>
        </aerosurface_scale>

        <!-- used for animating nozzle indicator -->
        <switch name="names/throttle/nozzle">
            <default value="propulsion/engine/zone-scaled"/>
            <test logic="OR" value="/engines/engine/nozzle-pos-norm">
              propulsion/engine/zone == 0
              propulsion/engine/augmentation == 0
          </test>
            <output>propulsion/engine/nozzle</output>
        </switch>

        <!-- used for animating afterburner flame -->
        <switch name="names/throttle/aug-flame">
            <default value="propulsion/engine/zone-scaled"/>
            <test logic="OR" value="0">
              propulsion/engine/augmentation == 0
          </test>
          <output>propulsion/engine/aug-flame</output>
          <output>/sim/multiplay/generic/float[3]</output>
        </switch>

        <!-- pure_gain is the only component that can overwrite fcs/throttle-pos-norm -->
        <pure_gain name="names/throttle/pos-norm">
            <input>fcs/throttle-pos-norm-scale</input>
            <gain>1.0</gain>
            <output>fcs/throttle-pos-norm</output>
            <!--<output>fcs/throttle-cmd-norm</output>-->
        </pure_gain>

        <switch name="names/throttle/augmentation">
            <default value="0"/>
            <test logic="AND" value="1">
              fcs/throttle-cmd-norm ge 0.940
              propulsion/engine/n2 ge 84
              /controls/engines/engine/cutoff-augmentation == 0
              /engines/engine/is-reversed == 0
              /engines/engine/afterburner/serviceable == 1
              /engines/engine/running == 1
          </test>
            <output>propulsion/engine/augmentation</output>
        </switch>

    </channel>




    <channel execrate="4" name="Autopilot">
        <scheduled_gain name="names/autopilot/Autopilot-max-climb">
            <input>autopilot/one</input>
            <table>
                <independentVar lookup="row">/instrumentation/airspeed-indicator/indicated-speed-kt</independentVar>
                <tableData>
                              <!-- feet/min -->
                      000             0
                      175             0
                      225            50
                      350         15000
                      700         20000
                     1400         75000
                </tableData>
            </table>
            <output>autopilot/climb</output><!-- feet/sec -->
        </scheduled_gain>

        <pure_gain name="names/autopilot/Autopilot-min-climb">
            <input>autopilot/climb</input>
            <gain>-0.2</gain>
            <output>autopilot/descent</output>
        </pure_gain>

        <fcs_function name="names/autopilot/Autopilot-min-elevator">
            <function>
                <table>
                    <independentVar lookup="row">/ja37/accelerations/pilot-G</independentVar>
                    <tableData>
                        3.0           -0.75
                        4.5           -0.1
                    </tableData>
                </table>
            </function>
            <output>/autopilot/internal/min-elevator</output>
        </fcs_function>

        <fcs_function name="names/autopilot/Autopilot-max-elevator">
            <function>
                <table>
                    <independentVar lookup="row">/ja37/accelerations/pilot-G</independentVar>
                    <tableData>
                       -1.20           0
                       -0.20           0.75
                    </tableData>
                </table>
            </function>
            <output>/autopilot/internal/max-elevator</output>
        </fcs_function>

    </channel>



    <!--<channel name="Hook">
        <kinematic name="names/carrier/hook-pos-norm">
            <input>fcs/carrier/hook-engage</input>
            <traverse>
                <setting>
                    <position>0</position>
                    <time>0</time>
                </setting>
                <setting>
                    <position>1</position>
                    <time>2.5</time>
                </setting>
            </traverse>
            <output>fcs/carrier/hook-pos-norm</output>
        </kinematic>
    </channel>-->

    <!--<channel name="View">
      <summer name="position/h-sl-pilot-ft">
        <input>position/h-sl-ft</input>
        <input>position/selection-view-offset</input>
      </summer>
    </channel>-->



    <channel execrate="8" name="Wings">
        <aerosurface_scale name="names/structural/Wings-normal-factor">
            <input>structural/wings/serviceable</input>
            <zero_centered> false </zero_centered>
            <domain>
                <min>  0.0 </min>
                <max>  1.0 </max>
            </domain>
            <range>
                <min> 0.2 </min>
                <max> 1.0 </max>
            </range>
            <output>structural/wings/normal-factor</output>
        </aerosurface_scale>
    </channel>
</flight_control>
